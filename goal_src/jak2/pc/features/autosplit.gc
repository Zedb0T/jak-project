;;-*-Lisp-*-
(in-package goal)

(define *autosplit-info-jak2* (new 'static 'autosplit-info-jak2))
;; Setup markers
(charp<-string (-> *autosplit-info-jak2* end-marker) "end")
;; Setup Padding
(charp<-string (-> *autosplit-info-jak2* padding-stats) "padding-stats!")
(charp<-string (-> *autosplit-info-jak2* padding-controls) "padding-controls!")


(defun update-autosplit-info-jak2 ()
  ;; general statistics
  (set! (-> *autosplit-info-jak2* num-power-cells) (the int (-> *game-info* fuel)))
  (set! (-> *autosplit-info-jak2* num-orbs) (the int (-> *game-info* money-total)))
  (set! (-> *autosplit-info-jak2* num-scout-flies) (the int (-> *game-info* buzzer-total)))

  ;; per-level orb/fly counts
  #|
  (set! (-> *autosplit-info-jak2* training-num-orbs) (-> *game-info* money-per-level (level-task-data-index training)))
  (set! (-> *autosplit-info-jak2* village1-num-orbs) (-> *game-info* money-per-level (level-task-data-index village1)))
  |#

  #|
  (set! (-> *autosplit-info-jak2* training-num-scout-flies) (buzzer-count *game-info* (-> *level-task-data* (level-task-data-index training) task-info (-> *level-task-data* (level-task-data-index training) buzzer-task-index) task-id)))
  (set! (-> *autosplit-info-jak2* village1-num-scout-flies) (buzzer-count *game-info* (-> *level-task-data* (level-task-data-index village1) task-info (-> *level-task-data* (level-task-data-index village1) buzzer-task-index) task-id)))
  |#
  ;; loading/cutscene related flags
  (set! (-> *autosplit-info-jak2* in-cutscene?) (movie?))

  ;; need resolution flags
  ;; TODO - a macro for this would be nice
  #|
  (set! (-> *autosplit-info-jak2* res-ogre-boss) (if (task-complete? *game-info* (the-as game-task (-> obj task)))) 1 0))
  (set! (-> *autosplit-info-jak2* res-ogre-end) (if (task-closed? (game-task ogre-end) (task-status need-resolution)) 1 0))
  (set! (-> *autosplit-info-jak2* res-ogre-buzzer) (if (task-closed? (game-task ogre-buzzer) (task-status need-resolution)) 1 0))
  (set! (-> *autosplit-info-jak2* res-ogre-secret) (if (task-closed? (game-task ogre-secret) (task-status need-resolution)) 1 0))
  (set! (-> *autosplit-info-jak2* res-lavatube-end) (if (task-closed? (game-task lavatube-end) (task-status need-resolution)) 1 0))
  (set! (-> *autosplit-info-jak2* res-lavatube-buzzer) (if (task-closed? (game-task lavatube-buzzer) (task-status need-resolution)) 1 0))
  (set! (-> *autosplit-info-jak2* res-lavatube-balls) (if (task-closed? (game-task lavatube-balls) (task-status need-resolution)) 1 0))
  (set! (-> *autosplit-info-jak2* res-intro) (if (task-closed? (game-task intro) (task-status need-resolution)) 1 0))

  ;; other misc tasks
  (set! (-> *autosplit-info-jak2* int-finalboss-movies) (if (task-closed? (game-task finalboss-movies) (task-status need-introduction)) 1 0))
  (set! (-> *autosplit-info-jak2* unk-finalboss-movies) (if (task-closed? (game-task finalboss-movies) (task-status unknown)) 1 0))
  (set! (-> *autosplit-info-jak2* int-jungle-fishgame) (if (task-closed? (game-task jungle-fishgame) (task-status need-introduction)) 1 0))

  ;; end
  |#
  (set! (-> *autosplit-info-jak2* res-unknown) (if (task-complete? *game-info* (game-task unknown)) 1 0))
  (set! (-> *autosplit-info-jak2* res-none) (if (task-complete? *game-info* (game-task none)) 1 0))
  (set! (-> *autosplit-info-jak2* res-complete) (if (task-complete? *game-info* (game-task complete)) 1 0))
  (set! (-> *autosplit-info-jak2* res-dummy0) (if (task-complete? *game-info* (game-task dummy0)) 1 0))
  (set! (-> *autosplit-info-jak2* res-eco-blue-button) (if (task-complete? *game-info* (game-task eco-blue-button)) 1 0))
  (set! (-> *autosplit-info-jak2* res-eco-yellow-button) (if (task-complete? *game-info* (game-task eco-yellow-button)) 1 0))
  (set! (-> *autosplit-info-jak2* res-eco-red-button) (if (task-complete? *game-info* (game-task eco-red-button)) 1 0))
  (set! (-> *autosplit-info-jak2* res-fortress-escape) (if (task-complete? *game-info* (game-task fortress-escape)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-help-kid) (if (task-complete? *game-info* (game-task city-help-kid)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-vehicle-training) (if (task-complete? *game-info* (game-task city-vehicle-training)) 1 0))
  (set! (-> *autosplit-info-jak2* res-ruins-tower) (if (task-complete? *game-info* (game-task ruins-tower)) 1 0))
  (set! (-> *autosplit-info-jak2* res-atoll-water) (if (task-complete? *game-info* (game-task atoll-water)) 1 0))
  (set! (-> *autosplit-info-jak2* res-fortress-dump) (if (task-complete? *game-info* (game-task fortress-dump)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-krew-delivery) (if (task-complete? *game-info* (game-task city-krew-delivery)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-red-gun-training) (if (task-complete? *game-info* (game-task city-red-gun-training)) 1 0))
  (set! (-> *autosplit-info-jak2* res-atoll-sig) (if (task-complete? *game-info* (game-task atoll-sig)) 1 0))
  (set! (-> *autosplit-info-jak2* res-sewer-enemy) (if (task-complete? *game-info* (game-task sewer-enemy)) 1 0))
  (set! (-> *autosplit-info-jak2* res-strip-rescue) (if (task-complete? *game-info* (game-task strip-rescue)) 1 0))
  (set! (-> *autosplit-info-jak2* res-atoll-battle) (if (task-complete? *game-info* (game-task atoll-battle)) 1 0))
  (set! (-> *autosplit-info-jak2* res-mountain-lens) (if (task-complete? *game-info* (game-task mountain-lens)) 1 0))
  (set! (-> *autosplit-info-jak2* res-mountain-gear) (if (task-complete? *game-info* (game-task mountain-gear)) 1 0))
  (set! (-> *autosplit-info-jak2* res-mountain-shard) (if (task-complete? *game-info* (game-task mountain-shard)) 1 0))
  (set! (-> *autosplit-info-jak2* res-mountain-collection) (if (task-complete? *game-info* (game-task mountain-collection)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-keira-delivery) (if (task-complete? *game-info* (game-task city-keira-delivery)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-board1) (if (task-complete? *game-info* (game-task stadium-board1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-krew-collection) (if (task-complete? *game-info* (game-task city-krew-collection)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-yellow-gun-training) (if (task-complete? *game-info* (game-task city-yellow-gun-training)) 1 0))
  (set! (-> *autosplit-info-jak2* res-drill-eggs) (if (task-complete? *game-info* (game-task drill-eggs)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-power) (if (task-complete? *game-info* (game-task city-power)) 1 0))
  (set! (-> *autosplit-info-jak2* res-palace-cable) (if (task-complete? *game-info* (game-task palace-cable)) 1 0))
  (set! (-> *autosplit-info-jak2* res-palace-boss) (if (task-complete? *game-info* (game-task palace-boss)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-shuttle) (if (task-complete? *game-info* (game-task city-shuttle)) 1 0))
  (set! (-> *autosplit-info-jak2* res-ruins-enemy) (if (task-complete? *game-info* (game-task ruins-enemy)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-blue-gun-training) (if (task-complete? *game-info* (game-task city-blue-gun-training)) 1 0))
  (set! (-> *autosplit-info-jak2* res-forest-scouts) (if (task-complete? *game-info* (game-task forest-scouts)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-escort-kid) (if (task-complete? *game-info* (game-task city-escort-kid)) 1 0))
  (set! (-> *autosplit-info-jak2* res-dig-knock-down) (if (task-complete? *game-info* (game-task dig-knock-down)) 1 0))
  (set! (-> *autosplit-info-jak2* res-strip-grenade) (if (task-complete? *game-info* (game-task strip-grenade)) 1 0))
  (set! (-> *autosplit-info-jak2* res-drill-ship) (if (task-complete? *game-info* (game-task drill-ship)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-port-run) (if (task-complete? *game-info* (game-task city-port-run)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-meet-brutter) (if (task-complete? *game-info* (game-task city-meet-brutter)) 1 0))
  (set! (-> *autosplit-info-jak2* res-sewer-board) (if (task-complete? *game-info* (game-task sewer-board)) 1 0))
  (set! (-> *autosplit-info-jak2* res-forest-hunt) (if (task-complete? *game-info* (game-task forest-hunt)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-intercept-tanker) (if (task-complete? *game-info* (game-task city-intercept-tanker)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-race-class3) (if (task-complete? *game-info* (game-task stadium-race-class3)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-protect-water-slums) (if (task-complete? *game-info* (game-task city-protect-water-slums)) 1 0))
  (set! (-> *autosplit-info-jak2* res-dig-find-totem) (if (task-complete? *game-info* (game-task dig-find-totem)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-destroy-guard-vehicles) (if (task-complete? *game-info* (game-task city-destroy-guard-vehicles)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-play-onin-game) (if (task-complete? *game-info* (game-task city-play-onin-game)) 1 0))
  (set! (-> *autosplit-info-jak2* res-canyon-insert-items) (if (task-complete? *game-info* (game-task canyon-insert-items)) 1 0))
  (set! (-> *autosplit-info-jak2* res-tomb-poles) (if (task-complete? *game-info* (game-task tomb-poles)) 1 0))
  (set! (-> *autosplit-info-jak2* res-tomb-water) (if (task-complete? *game-info* (game-task tomb-water)) 1 0))
  (set! (-> *autosplit-info-jak2* res-tomb-boss) (if (task-complete? *game-info* (game-task tomb-boss)) 1 0))
  (set! (-> *autosplit-info-jak2* res-fortress-save-friends) (if (task-complete? *game-info* (game-task fortress-save-friends)) 1 0))
  (set! (-> *autosplit-info-jak2* res-sewer-escort) (if (task-complete? *game-info* (game-task sewer-escort)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-dark-gun-training) (if (task-complete? *game-info* (game-task city-dark-gun-training)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-race-class2) (if (task-complete? *game-info* (game-task stadium-race-class2)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-stop-bomb-bots) (if (task-complete? *game-info* (game-task city-stop-bomb-bots)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-errol-challenge) (if (task-complete? *game-info* (game-task city-errol-challenge)) 1 0))
  (set! (-> *autosplit-info-jak2* res-strip-drop) (if (task-complete? *game-info* (game-task strip-drop)) 1 0))
  (set! (-> *autosplit-info-jak2* res-ruins-mech) (if (task-complete? *game-info* (game-task ruins-mech)) 1 0))
  (set! (-> *autosplit-info-jak2* res-forest-protect) (if (task-complete? *game-info* (game-task forest-protect)) 1 0))
  (set! (-> *autosplit-info-jak2* res-drill-mech) (if (task-complete? *game-info* (game-task drill-mech)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-save-lurkers) (if (task-complete? *game-info* (game-task city-save-lurkers)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-race-class) (if (task-complete? *game-info* (game-task stadium-race-class)) 1 0))
  (set! (-> *autosplit-info-jak2* res-palace-sneak-in) (if (task-complete? *game-info* (game-task palace-sneak-in)) 1 0))
  (set! (-> *autosplit-info-jak2* res-castle-break-in) (if (task-complete? *game-info* (game-task castle-break-in)) 1 0))
  (set! (-> *autosplit-info-jak2* res-castle-boss) (if (task-complete? *game-info* (game-task castle-boss)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-whack) (if (task-complete? *game-info* (game-task city-whack)) 1 0))
  (set! (-> *autosplit-info-jak2* res-under-mech) (if (task-complete? *game-info* (game-task under-mech)) 1 0))
  (set! (-> *autosplit-info-jak2* res-under-sig) (if (task-complete? *game-info* (game-task under-sig)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-defend-stadium) (if (task-complete? *game-info* (game-task city-defend-stadium)) 1 0))
  (set! (-> *autosplit-info-jak2* res-consite-find-baron) (if (task-complete? *game-info* (game-task consite-find-baron)) 1 0))
  (set! (-> *autosplit-info-jak2* res-nest-get-to-gun) (if (task-complete? *game-info* (game-task nest-get-to-gun)) 1 0))
  (set! (-> *autosplit-info-jak2* res-nest-enter) (if (task-complete? *game-info* (game-task nest-enter)) 1 0))
  (set! (-> *autosplit-info-jak2* res-nest-boss) (if (task-complete? *game-info* (game-task nest-boss)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-win) (if (task-complete? *game-info* (game-task city-win)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-oracle) (if (task-complete? *game-info* (game-task city-oracle)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-ring-1) (if (task-complete? *game-info* (game-task city-burning-bush-ring-1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-1) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-2) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-2)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-3) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-3)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-4) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-4)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-collection-1) (if (task-complete? *game-info* (game-task city-burning-bush-collection-1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-racepoint-1) (if (task-complete? *game-info* (game-task city-burning-bush-racepoint-1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-ring-2) (if (task-complete? *game-info* (game-task city-burning-bush-ring-2)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-5) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-5)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-6) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-6)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-shuttle-1) (if (task-complete? *game-info* (game-task city-burning-bush-shuttle-1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-7) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-7)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-8) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-8)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-9) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-9)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-collection-2) (if (task-complete? *game-info* (game-task city-burning-bush-collection-2)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-10) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-10)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-11) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-11)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-ring-3) (if (task-complete? *game-info* (game-task city-burning-bush-ring-3)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-12) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-12)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-bombbot-1) (if (task-complete? *game-info* (game-task city-burning-bush-bombbot-1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-13) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-13)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-14) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-14)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-get-to-15) (if (task-complete? *game-info* (game-task city-burning-bush-get-to-15)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-collection-3) (if (task-complete? *game-info* (game-task city-burning-bush-collection-3)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-race-errol) (if (task-complete? *game-info* (game-task city-burning-bush-race-errol)) 1 0))
  (set! (-> *autosplit-info-jak2* res-city-burning-bush-race-port) (if (task-complete? *game-info* (game-task city-burning-bush-race-port)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-board) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-board)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-class3) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-class3)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-class2) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-class2)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-class1) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-class1)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-class3-r) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-class3-r)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-class2-r) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-class2-r)) 1 0))
  (set! (-> *autosplit-info-jak2* res-stadium-burning-bush-race-class1-r) (if (task-complete? *game-info* (game-task stadium-burning-bush-race-class1-r)) 1 0))
  (set! (-> *autosplit-info-jak2* res-max) (if (task-complete? *game-info* (game-task max)) 1 0))
  
  (none))


(defun update-autosplit-jak2-new-game ()
  (set! (-> *autosplit-info-jak2* game-hash) (pc-get-unix-timestamp))
  (none))
